# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –í–ú –≤ Yandex Cloud —á–µ—Ä–µ–∑ Terraform

–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –¥–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω (–í–ú) –≤ Yandex Cloud —Å –ø–æ–º–æ—â—å—é Terraform:

- **–ß–µ—Ä–µ–∑ `for_each` –≤ –∫–æ—Ä–Ω–µ–≤–æ–º –º–æ–¥—É–ª–µ** ‚Äî –µ–¥–∏–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –∏—Ç–µ—Ä–∞—Ü–∏–µ–π –ø–æ —Å–ø–∏—Å–∫—É.
- **–ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–æ–¥—É–ª—å** ‚Äî –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ –í–ú –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å.

---

## Branches

| –í–µ—Ç–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------|
| [`for-each-vpc`](https://github.com/<–≤–∞—à-–ª–æ–≥–∏–Ω>/<—Ä–µ–ø–æ>/tree/for-each-approach) | –°–æ–∑–¥–∞–Ω–∏–µ –í–ú –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ—Ä–Ω–µ–≤–æ–º –º–æ–¥—É–ª–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `for_each`. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏–ª–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è. |
| [`module-vpc`](https://github.com/<–≤–∞—à-–ª–æ–≥–∏–Ω>/<—Ä–µ–ø–æ>/tree/module-approach) | –°–æ–∑–¥–∞–Ω–∏–µ –í–ú —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã–π –º–æ–¥—É–ª—å `vm`. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices: –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è, –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å. |

> üîÅ –ß—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –º–µ–∂–¥—É –ø–æ–¥—Ö–æ–¥–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É–π:
> ```bash
> git checkout for-each-vpc
> # –∏–ª–∏
> git checkout module-vpc
> ```

---

## –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- [Terraform](https://www.terraform.io/downloads) ‚â• 1.0
- –ê–∫–∫–∞—É–Ω—Ç –≤ [Yandex Cloud](https://cloud.yandex.ru/)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π CLI: `yc config set cloud-id <ID>` –∏ `yc config set folder-id <ID>`
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è Terraform —á–µ—Ä–µ–∑:
  - `YC_TOKEN` (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è), **–ò–õ–ò**
  - IAM-—Ç–æ–∫–µ–Ω –≤ `~/.yc/config`, **–ò–õ–ò**
  - —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å –∫–ª—é—á–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è CI)

---

```
## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–æ–±—â–∞—è)
‚îú‚îÄ‚îÄ main.tf # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ä–∞–∑–Ω–∞—è –≤ –≤–µ—Ç–∫–∞—Ö) 
‚îú‚îÄ‚îÄ variables.tf # –í—Ö–æ–¥–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ 
‚îú‚îÄ‚îÄ terraform.tfvars # –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏–π (–º–æ–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ terraform.tfvars) 
‚îú‚îÄ‚îÄ meta.txt # Cloud-init / user-data –¥–ª—è –í–ú 
‚îî‚îÄ‚îÄ modules/ # –¢–æ–ª—å–∫–æ –≤ –≤–µ—Ç–∫–µ module-approach
|    ‚îî‚îÄ‚îÄ vpc
|        ‚îú‚îÄ‚îÄ main.tf
|        ‚îú‚îÄ‚îÄ outputs.tf
|        ‚îú‚îÄ‚îÄ variables.tf
|        ‚îú‚îÄ‚îÄ versions.tf
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω—É–∂–Ω—É—é –≤–µ—Ç–∫—É**:
   ```bash
   git clone https://github.com/<–≤–∞—à-–ª–æ–≥–∏–Ω>/<—Ä–µ–ø–æ>.git
   cd <—Ä–µ–ø–æ>
   git checkout <for-each-approach | module-approach>
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏):**
    ```bash
    cp terraform.tfvars.example terraform.tfvars
    # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ terraform.tfvars
    ```
3. –ò–Ω—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫
    ```bash
    terraform init
    terraform plan
    terraform apply
    ```